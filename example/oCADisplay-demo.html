<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/demo-style.css" />
    <link rel="stylesheet" href="../css/tomorrow-night.css" />
    <title>oCADisplay Demo</title>
  </head>
  <body>
    <header>
      <div>signalFirebase</div>
    </header>
    <main>
      <h1>oCADisplay Demo</h1>
      <h2>Output</h2>
      <div id="output"></div>
      <h2>Code</h2>
      <div id="code"></div>
      <h2>Customize and execute</h2>
      <div id="custom"></div>
      <button id="execute">Execute!!</button>
    </main>
    <footer>
      <div>Copyright (c) 2022 Kazutaka.Yokoi</div>
      <div>Released under the MIT license</div>
      <div>
        <a href="https://opensource.org/licenses/MIT"
          >https://opensource.org/licenses/MIT</a
        >
      </div>
    </footer>
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** 以下Firebase **-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        set,
        onChildAdded,
        remove,
        onChildRemoved,
        update,
        onChildChanged,
        get,
        child,
        onValue,
      } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      import {
        envapiKey,
        envauthDomain,
        envdatabaseURL,
        envprojectId,
        envstorageBucket,
        envmessagingSenderId,
        envappId,
      } from "../js/env.js";

      import { sg } from "../js/signalFirebase.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: envapiKey,
        authDomain: envauthDomain,
        databaseURL: envdatabaseURL,
        projectId: envprojectId,
        storageBucket: envstorageBucket,
        messagingSenderId: envmessagingSenderId,
        appId: envappId,
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const dbRef = ref(db, "chat");

      //Global variable
      let oCADisplayMainFunc;
      let oCADisplayOnLoadBool;
      let oCADisplayRealTimeBool;

      oCADisplayMainFunc = localStorage.getItem("oCADisplayMainFunc");
      oCADisplayOnLoadBool = localStorage.getItem("oCADisplayMainFunc");
      oCADisplayRealTimeBool = localStorage.getItem("oCADisplayMainFunc");

      const appendDemo = function (data) {
        $("#output").append(`<div>${data.key}, ${data.val().uname}, ${data.val().age}, ${data.val().text}</div>`);
      };

      const prependDemo = function (data) {
        $("#output").append(`<div>${data.key}</div>`);
      };

      if (
        oCADisplayMainFunc == null ||
        oCADisplayOnLoadBool == null ||
        oCADisplayRealTimeBool == null
      ) {
        sg("chat").oCADisplay(appendDemo, true, true);
        $("#code").html(`sg("chat").oCADisplay(oCADisplayMainFunc, true, true);`);

      }
    </script>
  </body>
</html>
